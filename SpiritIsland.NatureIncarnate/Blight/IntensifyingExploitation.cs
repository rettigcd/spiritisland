namespace SpiritIsland.NatureIncarnate;

public class IntensifyingExploitation : BlightCard {

	public IntensifyingExploitation()
		:base("Intensifying Exploitation", 
			"Ongoing, starting next turn: During Ravage Actions, Invaders deal +2 Damage (per land).", 
			5
		) 
	{}

	public override IActOn<GameState> Immediately 
		=> InvadersDoPlus2Damage().AtTheStartOfNextRound();

	static public IActOn<GameState> InvadersDoPlus2Damage() => new BaseCmd<GameState>( 
		$"From now on, During Ravage, Invaders do +2 Damage / land.",
		gs => gs.AddIslandMod(new ExtraDamage())
	);

	class ExtraDamage : BaseModEntity, IModifyLandDamage {
		void IModifyLandDamage.ModifyLandDamage( SpaceState spaceState, ref int damage ){
			// guard
			if(damage==0) return;
			var scope = ActionScope.Current;
			const string key = "Intesifying exploytation damage";
			if(scope.ContainsKey(key)) return;

			// mark it as used.
			scope[key] = true;

			// apply
			damage += 2;
		}
	}

}
