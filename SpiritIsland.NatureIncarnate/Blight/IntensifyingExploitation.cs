namespace SpiritIsland.NatureIncarnate;

public class IntensifyingExploitation : BlightCard {

	public IntensifyingExploitation()
		:base("Intensifying Exploitation", 
			"Ongoing, starting next turn: During Ravage Actions, Invaders deal +2 Damage (per land).", 
			5
		) 
	{}

	public override IActOn<GameState> Immediately => InvadersDoPlus2Damage().AtTheStartOfNextRound();

	static public IActOn<GameState> InvadersDoPlus2Damage() => new BaseCmd<GameState>( 
		$"From now on, During Ravage, Invaders do +2 Damage / land.",
		gs => gs.AddIslandMod(new ExtraDamage())
	);

	class ExtraDamage : BaseModEntity, IConfigRavages {
		public Task Config(Space space) {
			var behavior = space.RavageBehavior;
			Func<RavageExchange, int> originalAttackerDamage = behavior.GetDamageFromParticipatingAttackers;
			behavior.GetDamageFromParticipatingAttackers = (ex)=> originalAttackerDamage(ex)+2;
			return Task.CompletedTask;
		}
	}

}
